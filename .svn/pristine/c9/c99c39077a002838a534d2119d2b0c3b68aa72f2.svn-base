<script type="text/javascript">
	$(document).ready(function(){
		jQuery.validator.addMethod("kode_autocomplete", function(value, element, params){
		    if ($("input[name="+ params +"]").val()=="") {
		    	return false;
		    }else{
		    	return true;
		    }
		}, "Data tidak valid/belum di pilih, mohon pilih data setelah melakukan pencarian pada kolom ini."); 

		$("form#usulanpro").validate({
			rules: {			  
			  id_skpd_autocomplete : {
			  	required : true,
			  	kode_autocomplete : "id_skpd"
			  },
			  id_kec_autocomplete : {
			  	required : true,
			  	kode_autocomplete : "id_kec"
			  },
			  id_desa_autocomplete : {
			  	required : true,
			  	kode_autocomplete : "id_desa"
			  },
			  jenis_pekerjaan : "required",
			  volume : {
			  	required : true,
			  	number: true			  	
			  },
			  satuan : "required",
			  lokasi : "required"
			}
	    });

		$("#simpan").click(function(){			
		    var valid = $("form#usulanpro").valid();
		    if (valid) {		    	
		    	$("form#usulanpro").submit();
		    };
		});

		$("#id_skpd_autocomplete").autocomplete({
	      minLength: 0,
	      source: 
	      function(req, add){	          
	          $("#id_skpd").val("");
	          $.ajax({
	              url: "<?php echo base_url('common/autocomplete_skpd'); ?>",
	              dataType: 'json',
	              type: 'POST',
	              data: req,
	              success:    
	              function(data){                      
	                add(data);                      
	              },
	          });
	      },
	      select: 
	      function(event, ui) {                        
	        $("#id_skpd").val(ui.item.id);                          
	      }
	    }).focus(function(){            
	        $(this).trigger('keydown.autocomplete');
	    });		

	    $("#id_kec_autocomplete").autocomplete({
	      minLength: 0,
	      source: 
	      function(req, add){
	          $("#id_kec").val("");

	          $("#id_desa_autocomplete").val("");	          
	          $.ajax({
	              url: "<?php echo base_url('common/autocomplete_kec'); ?>",
	              dataType: 'json',
	              type: 'POST',
	              data: req,
	              success:    
	              function(data){                      
	                add(data);                      
	              },
	          });
	      },
	      select: 
	      function(event, ui) {                        
	        $("#id_kec").val(ui.item.id);                          
	      }
	    }).focus(function(){            
	        $(this).trigger('keydown.autocomplete');
	    });

	    $("#id_desa_autocomplete").autocomplete({
	      minLength: 0,
	      source: 
	      function(req, add){
	          $("#id_desa").val("");
	          req.id_kec = $("#id_kec").val();
	          $.ajax({
	              url: "<?php echo base_url('common/autocomplete_desa'); ?>",
	              dataType: 'json',
	              type: 'POST',
	              data: req,
	              success:    
	              function(data){                      
	                add(data);                      
	              },
	          });
	      },
	      select: 
	      function(event, ui) {                        
	        $("#id_desa").val(ui.item.id);                          
	      }
	    }).focus(function(){            
	        $(this).trigger('keydown.autocomplete');
	    });
	});
</script>
<article class="module width_full">
 	<header>
 		<h3>
		<?php
			if (!empty($usulanpro)){
			    echo "Edit Data Usulan";
			} else{
			    echo "Input Data Usulan";
			}
		?>
		</h3>
 	</header>
 	<div class="module_content">
 		<form action="<?php echo site_url('usulanpro/save');?>" method="POST" name="usulanpro" id="usulanpro" accept-charset="UTF-8" enctype="multipart/form-data" >
 			<input type="hidden" name="id_usulanpro" value="<?php if(!empty($usulanpro->id)){echo $usulanpro->id;} ?>" />
 			<table class="fcari" width="100%">
 				<tbody>
 					<tr>
 						<td width="20%">Group</td>
 						<td width="80%"><?php echo $group->nama_group; ?></td>
					</tr> 					
					<tr>
						<td>SKPD Tujuan</td>
						<td>
							<input type="text" id="id_skpd_autocomplete" name="id_skpd_autocomplete" class="common" value="<?php if(!empty($usulanpro->nama_skpd)){echo $usulanpro->nama_skpd;} ?>" />
	            			<input type="hidden" id="id_skpd" name="id_skpd" value="<?php if(!empty($usulanpro->id_skpd)){echo $usulanpro->id_skpd;} ?>"/>
						</td>
					</tr>
					<tr style="background-color: white;">
						<td colspan="2"><hr></td>
					</tr>
					<tr>
						<td>Kecamatan Sasaran</td>
						<td>
							<input type="text" id="id_kec_autocomplete" name="id_kec_autocomplete" class="common" value="<?php if(!empty($usulanpro->nama_kec)){echo $usulanpro->nama_kec;} ?>" />
	            			<input type="hidden" id="id_kec" name="id_kec" value="<?php if(!empty($usulanpro->id_kec)){echo $usulanpro->id_kec;} ?>"/>
						</td>
					</tr>
					<tr>
						<td>Desa Sasaran</td>
						<td>
							<input type="text" id="id_desa_autocomplete" name="id_desa_autocomplete" class="common" value="<?php if(!empty($usulanpro->nama_desa)){echo $usulanpro->nama_desa;} ?>" />
	            			<input type="hidden" id="id_desa" name="id_desa" value="<?php if(!empty($usulanpro->id_desa)){echo $usulanpro->id_desa;} ?>"/>
						</td>
					</tr>
					<tr>
						<td>Jenis Pekerjaan</td>
						<td><input class="common" type="text" name="jenis_pekerjaan" value="<?php if(!empty($usulanpro->jenis_pekerjaan)){echo $usulanpro->jenis_pekerjaan;} ?>"/></td>
					</tr>
					<tr>
						<td>Volume</td>
						<td><input class="common" type="text" name="volume" value="<?php if(!empty($usulanpro->volume)){echo $usulanpro->volume;} ?>"/></td>
					</tr>
					<tr>
						<td>Satuan</td>
						<td><input class="common" type="text" name="satuan" value="<?php if(!empty($usulanpro->satuan)){echo $usulanpro->satuan;} ?>"/></td>
					</tr>
					<tr>
						<td>Lokasi</td>
						<td><input class="common" type="text" name="lokasi" value="<?php if(!empty($usulanpro->lokasi)){echo $usulanpro->lokasi;} ?>"/></td>
					</tr>
					<tr>
						<td>Catatan</td>
						<td>
							<textarea class="common" name="catatan"><?php if(!empty($usulanpro->catatan)){echo $usulanpro->catatan;} ?></textarea>
						</td>
					</tr>					
 				</tbody>
 			</table>
 		</form> 		
 	</div> 	
 	<footer>
		<div class="submit_link">  
  			<input type='button' id="simpan" name="simpan" value='Simpan' />
  			<input type="button" value="Keluar" onclick="window.location.href='<?php echo site_url('usulanpro'); ?>'" />
		</div> 
	</footer>
</article>